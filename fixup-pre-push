
# Copyright (c) 2017 Matt Champion

# This hook is called with the two parameters:
#
# - name of the remote being pushed to
# - URL of the remote being pushed to
#
# Information about the commits to be pushed is passed
# through the standard input. A single line is provided for
# each ref being pushed:
#
# <local ref> <local sha1> <remote ref> <remote sha1>

remote="$1"
url="$2"

IFS=' '
while read local_ref local_sha remote_ref remote_sha
do
    git log --format=%B -n 1 ${local_sha} | grep -i fixup >> /dev/null
    if [ $? -eq 0 ]; then
        echo "${local_sha} rejected, needs to be fixed up"
        git log --format=%B -n 1 ${local_sha} | cat
        echo "Alternatively use the flag --no-verify to disable the verification."
        exit 1
    fi
done

exit 0
